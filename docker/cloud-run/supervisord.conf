[supervisord]
nodaemon=true
user=root
logfile=/dev/stdout
logfile_maxbytes=0
loglevel=info

[program:mosquitto]
command=/usr/sbin/mosquitto -c /etc/mosquitto/mosquitto.conf
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=10

[program:gateway]
command=/opt/saic-gateway/.venv/bin/python /opt/saic-gateway/src/main.py
directory=/opt/saic-gateway
environment=HOME="/root",MQTT_URI="tcp://localhost:1883",MQTT_USER="mg_gateway",MQTT_PASSWORD="",MQTT_HOST="localhost",MQTT_PORT="1883",MQTT_TOPIC="saic",SAIC_USER="%(ENV_SAIC_USERNAME)s",SAIC_PASSWORD="%(ENV_SAIC_PWD)s",SAIC_REST_URI="https://gateway-mg-eu.soimt.com/api.app/v1/",SAIC_REGION="eu",SAIC_TENANT_ID="459771",SAIC_RELOGIN_DELAY="5",HA_DISCOVERY_ENABLED="true",ACTIVE_QUERY_INTERVAL="5",SLEEP_QUERY_INTERVAL="5",INACTIVE_QUERY_INTERVAL="5",LOG_LEVEL="INFO"
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=20
startsecs=10

[program:ingest]
command=npx tsx server/ingest.ts
directory=/app
environment=NODE_ENV="production",NEXT_PUBLIC_SUPABASE_URL="%(ENV_NEXT_PUBLIC_SUPABASE_URL)s",SUPABASE_SERVICE_ROLE_KEY="%(ENV_SUPABASE_SERVICE_ROLE_KEY)s",MQTT_BROKER_URL="mqtt://localhost:1883",MQTT_USER="mtc_ingest",MQTT_PASSWORD="",MQTT_TOPIC="saic",SAIC_USER="system@air.city"
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=30
startsecs=10

[program:command-api]
command=npx tsx server/command-api.ts
directory=/app
environment=NODE_ENV="production",NEXT_PUBLIC_SUPABASE_URL="%(ENV_NEXT_PUBLIC_SUPABASE_URL)s",SUPABASE_SERVICE_ROLE_KEY="%(ENV_SUPABASE_SERVICE_ROLE_KEY)s",PORT="8080"
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=40
startsecs=10
